{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'T.png' %}" type="image/x-icon">
    <title>Gestion Donnee</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <style>
        /* Global Styles */
        body {
            margin: 0;
            padding: 20px;
        }
    
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
    
        .page-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
    
        main.content {
            flex: 1;
            padding: 0;
            position: relative;
        }
    
        .form-container {
            margin: 0;
            padding: 0;
        }
    
        .btn-info {
            margin: 0;
        }
    
        /* Table Styles */
        .custom-table-striped {
            font-size: 12px;
            min-width: 100px;
        }
    
        .custom-table-striped tbody tr:nth-of-type(odd) {
            background-color: #f2f2f2; /* Fond des lignes impaires */
        }
    
        .custom-table-striped tbody tr:nth-of-type(even) {
            background-color: #e9e9e9; /* Fond des lignes paires */
        }
    
        .custom-table-striped th, 
        .custom-table-striped td {
            vertical-align: middle; /* Centrer verticalement */
            text-align: left; /* Alignement du texte */
            padding: 8px; /* Espacement interne */
            word-wrap: break-word; /* Gérer les mots longs */
            white-space: normal; /* Retour à la ligne automatique */
        }
    
        .custom-table-striped th {
            background-color: #48b5e8; /* Fond de l'en-tête */
            color: white; /* Texte blanc */
            text-align: center; /* Texte centré */
            padding: 10px; /* Espacement pour l'en-tête */
        }
    
        .table-hover tbody tr:hover {
            background-color: #d1ecf1; /* Couleur de survol */
        }
    
        .table {
            width: 100%;
            /* Respecte les largeurs définies dans le HTML */
            /* S'assure que le tableau occupe toute la largeur */
        }
    
        .custom-table-striped .text-wrap {
            max-width: 100%; /* Largeur maximale pour le texte */
            word-wrap: break-word; /* Coupe les mots longs */
            white-space: normal; /* Retour à la ligne automatique */
        }
    
        /* Description Text Styles */
        .description-text {
            display: -webkit-box;
             /* Limite l'affichage à 3 lignes */
            -webkit-box-orient: vertical;
            overflow: hidden; /* Cache le texte supplémentaire */
            text-overflow: ellipsis; /* Ajoute "..." si le texte dépasse */
            white-space: normal; /* Permet le retour à la ligne */
            word-wrap: break-word; /* Coupe les mots longs */
             /* S'assure que le texte occupe toute la largeur de la cellule */
        }
    
        /* Form Group */
        .form-group {
            margin-bottom: 1rem;
        }
    
        .custom-table-statistics thead th {
            background-color: #8f8ff3; /* Couleur de fond pour l'en-tête */
            color: white; /* Couleur du texte dans l'en-tête */
            text-align: left; /* Alignement du texte */
            padding: 10px; /* Ajustement de l'espacement */
        }

        .table-container-x {
    overflow-x: auto;  
   
    /* Active le défilement horizontal */
             /* S'assure que le conteneur occupe toute la largeur */



             #error-message {
    background-color: #f8d7da;  /* Couleur rouge clair */
    color: #721c24;  /* Texte en rouge foncé */
    padding: 15px;
    border-radius: 5px;
    border: 1px solid #f5c6cb;  /* Bordure rose pâle */
    margin-bottom: 20px;
    font-size: 16px;
    display: none;  /* Par défaut, caché */
}

#error-message strong {
    font-weight: bold;
}

}
#motcleChart{
            width: 80% !important;  /* Réduit la taille du graphique */
            height: 300px !important; /* Réduit la hauteur */
        }


    </style>
    
</head>
<body>
    <header>
        {% include 'navbar.html' %}
    </header>
    <main class="content mt-20">
        <div class="container">
            <br/>
            <!-- Formulaire de mise à jour des données et téléchargement en Excel -->
            <form method="get" class="form-container" action="{% url 'remove_duplicate_articles' %}"><!-- "{% url 'remove_duplicate_articles' %}-->
                {% csrf_token %}
                <button type="submit" class="btn btn-info">Actualise Donnees</button>
                <a href="{% url 'telecharger_excel' %}" class="btn btn-success">Telecharger Articles</a>
            </form>

            <br/>
            <!-- Formulaire de recherche -->
            <fieldset class="row g-9 border p-20">
                <legend class="w-auto px-10"><h3>Recherche :</h3></legend>
                
                
                <form method="get" action="{% url 'Statistiques_mot_cle' %}">
                    <div class="form-row col-md-12">
                        <div class="form-group col-md-2">
                            <label for="combobox_select_site">Selectionner le Site :</label>
                            <div class="input-group input-group-sm mb-3">
                                <select id="combobox_select_site" name="combobox_select_site" class="form-control">
                                    <option value="Tous les sites">Tous les sites</option>
                                    <option value="www.Lemonde.fr">www.Lemonde.fr</option>
                                    <option value="www.Liberation.fr">www.Liberation.fr</option>
                                    <option value="www.Lefigaro.fr">www.Lefigaro.fr</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="search_order">Ordre d'Actualité :</label>
                            <div class="input-group input-group-sm mb-3">
                                <select id="search_order" name="search_order" class="form-control">
                                    <option value=""> </option>
                                    <option value="1">Ordre 1</option>
                                    <option value="2">Ordre 2</option>
                                    <option value="3">Ordre 3</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="search_categories">Categorie :</label>
                            <div class="input-group input-group-sm mb-3">
                                <input list="search_categorie" name="search_categorie" class="form-control">
                                <datalist id="search_categorie">
                                    <option value="">Aucune categorie</option>
                                    {% for cat in categories %}
                                    <option>{{ cat }}</option>
                                    {% endfor %}
                                </datalist>
                            </div>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="search_mot_cle">Mot Cle :</label>
                            <div class="input-group input-group-sm mb-3">
                                <input type="text" id="search_mot_cle" name="search_mot_cle" class="form-control" value="{{ request.GET.search_mot_cle }}">
                            </div>
                        </div>
                        <div class="form-group col-md-2" id="simple_date_search">
                            <label for="search_date">Date :</label>
                            <div class="input-group input-group-sm mb-3">
                                <input type="datetime-local" id="search_date" name="search_date" class="form-control" value="{{ request.GET.search_date }}">
                            </div>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="search_between_dates">Entre deux dates</label>
                            <div class="input-group input-group-sm mb-3">
                                <input type="checkbox" id="search_between_dates" name="search_between_dates" class="form-control" {{ request.GET.search_between_dates|yesno:"checked," }}>
                            </div>
                        </div>
                    </div>
                    <div class="form-row col-md-12" id="date_range_search" style="display: none;">
                        <div class="form-group col-md-3">
                            <label for="search_date_debut">Date Debut :</label>
                            <div class="input-group input-group-sm mb-3">
                                <input type="datetime-local" id="search_date_debut" name="search_date_debut" class="form-control" value="{{ request.GET.search_date_debut }}">
                            </div>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="search_date_fin">Date Fin :</label>
                            <div class="input-group input-group-sm mb-3">
                                <input type="datetime-local" id="search_date_fin" name="search_date_fin" class="form-control" value="{{ request.GET.search_date_fin }}">
                            </div>
                        </div>
                    </div>
                    <div id="error-message" class="alert alert-danger alert-dismissible fade show" role="alert" style="display: none;">
                        <strong>Erreur !</strong> La date de début doit être inférieure ou égale à la date de fin.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <button type="submit" class="btn btn-primary">Rechercher</button>
                </form>  
            </fieldset>
            <br/>
            <div class="mt-8">
                <h5>Statistiques Recherche :</h5>
                <table class="table custom-table-statistics"> <!-- No changes here, keeping default Bootstrap style -->
                    <thead>
                        <tr>
                            <th>Mot-clé</th>
                            <th>Source</th>
                            <th>Nbr Total Articles</th>
                            <th>Nbr Titre d'accueil</th>
                            <th>Nbr Titre</th>
                            <th>Nbr Auteur</th>
                            <th>Nbr Description</th>
                            <th style="width: 5%;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if index_mot == -1 %}
                            {% if search_site == 'Tous les sites' %}
                                            {% if   search_mot_cle != '' %}
                   
                                                <tr>
                                                    <td>{{ search_mot_cle }}</td>
                                                    <td>www.Lemonde.fr</td>
                                                    <td>{{ total_articles_count_lemonde|intcomma }}</td>
                                                    <td>{{ mot_cle_count_titre_page_accueil_lemonde|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_titre_lemonde|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_auteur_lemonde|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_description_lemonde|intcomma  }}</td>
                                                    <td>
                                                        <div class="actions mt-1">
                                                            <div class="mb-2">
                                                                <button class="btn btn-primary fetch-chart-data"
                                                                        data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                                        data-motcle="{{ search_mot_cle|escapejs }}"
                                                                        >
                                                                    Graphe
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>   
                                                    
                                                </tr>
                                                <tr>
                                                    <td>{{ search_mot_cle }}</td>
                                                    <td>www.Liberation.fr</td>
                                                    <td>{{ total_articles_count_liberation|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_titre_page_accueil_liberation|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_titre_liberation|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_auteur_liberation|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_description_liberation|intcomma  }}</td>
                                                    <td>
                                                        <div class="actions mt-1">
                                                            <div class="mb-2">
                                                                <button class="btn btn-primary fetch-chart-data"
                                                                        data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                                        data-motcle="{{ search_mot_cle|escapejs }}"
                                                                        >
                                                                    Graphe
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>{{ search_mot_cle }}</td>
                                                    <td>www.Lefigaro.fr</td>
                                                    <td>{{ total_articles_count_lefigaro|intcomma }}</td>
                                                    <td>{{ mot_cle_count_titre_page_accueil_lefigaro|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_titre_lefigaro|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_auteur_lefigaro|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_description_lefigaro|intcomma  }}</td>
                                                    <td>
                                                        <div class="actions mt-1">
                                                            <div class="mb-2">
                                                                <button class="btn btn-primary fetch-chart-data"
                                                                        data-site="{{ 'www.Lefigaro.fr'|escapejs }}"
                                                                        data-motcle="{{ search_mot_cle|escapejs }}"
                                                                        >
                                                                    Graphe
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr style="background-color: #87e3f1;">
                                                    <td>{{ search_mot_cle }}</td>
                                                    <td>{{ search_site }}</td>
                                                    <td>{{ total_articles_count|intcomma }}</td>
                                                    <td>{{ mot_cle_count_titre_page_accueil|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_titre|intcomma  }}</td>
                                                    <td>{{ mot_cle_count_auteur|intcomma }}</td>
                                                    <td>{{ mot_cle_count_description|intcomma  }}</td>
                                                    <td>
                                                        <div class="actions mt-1">
                                                            <div class="mb-2">
                                                                <button class="btn btn-primary fetch-chart-data"
                                                                        data-site="{{ search_site|escapejs }}"
                                                                        data-motcle="{{ search_mot_cle|escapejs }}"
                                                                        >
                                                                    Graphe
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% else %}
                                                <tr style="background-color: #cde9ed;">
                                                    <td>{{ search_mot_cle }}</td>
                                                    <td>{{ search_site}}</td>
                                                    <td>{{ total_articles_count|intcomma}}</td>
                                                    <td>{{ mot_cle_count_titre_page_accueil|intcomma }}</td>
                                                    <td>{{ mot_cle_count_titre |intcomma}}</td>
                                                    <td>{{ mot_cle_count_auteur |intcomma}}</td>
                                                    <td>{{ mot_cle_count_description|intcomma }}</td>
                                                    <td>
                                                        <div class="actions mt-1">
                                                            <div class="mb-2">
                                                                <button class="btn btn-primary fetch-chart-data"
                                                                        data-site="{{ search_site|escapejs }}"
                                                                        data-motcle="{{ search_mot_cle|escapejs }}"
                                                                        >
                                                                    Graphe
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endif %}
                            {% else %}
                            <tr>
                                <td>{{ search_mot_cle }}</td>
                                <td>{{ search_site }}</td>
                                <td>{{ total_articles_count|intcomma}}</td>
                                <td>{{ mot_cle_count_titre_page_accueil|intcomma }}</td>
                                <td>{{ mot_cle_count_titre|intcomma }}</td>
                                <td>{{ mot_cle_count_auteur |intcomma}}</td>
                                <td>{{ mot_cle_count_description|intcomma }}</td>
                                <td>
                                    <div class="actions mt-1">
                                        <div class="mb-2">
                                            <button class="btn btn-primary fetch-chart-data"
                                                    data-site="{{ search_site|escapejs }}"
                                                    data-motcle="{{ search_mot_cle|escapejs }}"
                                                    >
                                                Graphe
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endif %} 
                        {% else %}
                            {% if partie2_mot|lower != partie1_mot|lower %}
                                {% if search_site == 'Tous les sites' %}
                                   
                                        <tr>
                                            <td>{{ partie1_mot }}</td>
                                            <td>www.Liberation.fr</td>
                                            <td>{{ total_articles_count_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_liberation_p1|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie1_mot }}</td>
                                            <td>www.Lemonde.fr</td>
                                            <td>{{ total_articles_count_lemonde_p1|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lemonde_p1|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie1_mot  }}</td>
                                            <td>www.Lefigaro.fr</td>
                                            <td>{{ total_articles_count_lefigaro_p1|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lefigaro_p1|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Lefigaro.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr style="background-color: #e5e8c2;">
                                            <td>{{ partie1_mot }}</td>
                                            <td>{{ search_site}}</td>
                                            <td>{{ total_articles_count_1|intcomma }}</td>
                                            <td>{{ mot_cle_1_count_titre_page_accueil |intcomma}}</td>
                                            <td>{{ mot_cle_1_count_titre |intcomma}}</td>
                                            <td>{{ mot_cle_1_count_auteur |intcomma}}</td>
                                            <td>{{ mot_cle_1_count_description |intcomma}}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ search_site|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie2_mot }}</td>
                                            <td>www.Liberation.fr</td>
                                            <td>{{ total_articles_count_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_liberation_p2|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                                data-motcle="{{ partie2_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie2_mot }}</td>
                                            <td>www.Lemonde.fr</td>
                                            <td>{{ total_articles_count_lemonde_p2|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lemonde_p2|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                            data-motcle="{{ partie2_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie2_mot  }}</td>
                                            <td>www.Lefigaro.fr</td>
                                            <td>{{ total_articles_count_lefigaro_p2|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lefigaro_p2|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Lefigaro.fr'|escapejs }}"
                                                                data-motcle="{{ partie2_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr style="background-color: #f5c6cb;">
                                            <td>{{ partie2_mot }}</td>
                                            <td>{{ search_site}}</td>
                                            <td>{{ total_articles_count_2|intcomma }}</td>
                                            <td>{{ mot_cle_2_count_titre_page_accueil|intcomma }}</td>
                                            <td>{{ mot_cle_2_count_titre |intcomma}}</td>
                                            <td>{{ mot_cle_2_count_auteur|intcomma }}</td>
                                            <td>{{ mot_cle_2_count_description|intcomma }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ search_site|escapejs }}"
                                                                data-motcle="{{ partie2_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    
                                {% elif search_site == 'www.Liberation.fr' %}
                                        <tr>
                                            <td>{{ partie1_mot }}</td>
                                            <td>www.Liberation.fr</td>
                                            <td>{{ total_articles_count_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_liberation_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_liberation_p1|intcomma  }}</td>
                                            <td>
                                                <div class="actions mt-1">
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                   
                                        <tr>
                                            <td>{{ partie2_mot }}</td>
                                            <td>www.Liberation.fr</td>
                                            <td>{{ total_articles_count_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_liberation_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_liberation_p2|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                            data-motcle="{{ partie2_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                {% elif search_site == 'www.Lemonde.fr' %}
                                        <tr>
                                            <td>{{ partie1_mot }}</td>
                                            <td>www.Lemonde.fr</td>
                                            <td>{{ total_articles_count_lemonde_p1|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lemonde_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lemonde_p1|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                            data-motcle="{{ partie1_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie2_mot }}</td>
                                            <td>www.Lemonde.fr</td>
                                            <td>{{ total_articles_count_lemonde_p2|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lemonde_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lemonde_p2|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                            data-motcle="{{ partie2_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                {% elif search_site == 'www.Lefigaro.fr' %}
                                        <tr>
                                            <td>{{ partie1_mot  }}</td>
                                            <td>www.Lefigaro.fr</td>
                                            <td>{{ total_articles_count_lefigaro_p1|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lefigaro_p1|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lefigaro_p1|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.LeFigaro.fr'|escapejs }}"
                                                            data-motcle="{{ partie1_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>{{ partie2_mot  }}</td>
                                            <td>www.Lefigaro.fr</td>
                                            <td>{{ total_articles_count_lefigaro_p2|intcomma }}</td>
                                            <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_titre_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_auteur_lefigaro_p2|intcomma  }}</td>
                                            <td>{{ mot_cle_count_description_lefigaro_p2|intcomma  }}</td>
                                            <td>
                                                <div class="mb-2">
                                                    <button class="btn btn-primary fetch-chart-data"
                                                            data-site="{{ 'www.LeFigaro.fr'|escapejs }}"
                                                            data-motcle="{{ partie2_mot|escapejs }}"
                                                            >
                                                        Graphe
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                
                                {% endif %}
                            {% else %}
                                {% if search_site == 'Tous les sites' %}
                                   
                                    <tr>
                                        <td>{{ partie1_mot }}</td>
                                        <td>www.Liberation.fr</td>
                                        <td>{{ total_articles_count_liberation_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_titre_page_accueil_liberation_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_titre_liberation_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_auteur_liberation_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_description_liberation_p1|intcomma  }}</td>
                                        <td>
                                            <div class="mb-2">
                                                <button class="btn btn-primary fetch-chart-data"
                                                        data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                        data-motcle="{{ partie1_mot|escapejs }}"
                                                        >
                                                    Graphe
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>{{ partie1_mot }}</td>
                                        <td>www.Lemonde.fr</td>
                                        <td>{{ total_articles_count_lemonde_p1|intcomma }}</td>
                                        <td>{{ mot_cle_count_titre_page_accueil_lemonde_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_titre_lemonde_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_auteur_lemonde_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_description_lemonde_p1|intcomma  }}</td>
                                        <td>
                                            <div class="mb-2">
                                                <button class="btn btn-primary fetch-chart-data"
                                                        data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                        data-motcle="{{ partie1_mot|escapejs }}"
                                                        >
                                                    Graphe
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>{{ partie1_mot  }}</td>
                                        <td>www.Lefigaro.fr</td>
                                        <td>{{ total_articles_count_lefigaro_p1|intcomma }}</td>
                                        <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_titre_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_auteur_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_description_lefigaro_p1|intcomma  }}</td>
                                        <td>
                                            <div class="mb-2">
                                                <button class="btn btn-primary fetch-chart-data"
                                                        data-site="{{ 'www.Lefigaro.fr'|escapejs }}"
                                                        data-motcle="{{ partie1_mot|escapejs }}"
                                                        >
                                                    Graphe
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr style="background-color: #e5e8c2;">
                                        <td>{{ partie1_mot }}</td>
                                        <td>{{ search_site}}</td>
                                        <td>{{ total_articles_count_1|intcomma }}</td>
                                        <td>{{ mot_cle_1_count_titre_page_accueil |intcomma}}</td>
                                        <td>{{ mot_cle_1_count_titre |intcomma}}</td>
                                        <td>{{ mot_cle_1_count_auteur |intcomma}}</td>
                                        <td>{{ mot_cle_1_count_description |intcomma}}</td>
                                        <td>
                                            <div class="mb-2">
                                                <button class="btn btn-primary fetch-chart-data"
                                                        data-site="{{ search_site|escapejs }}"
                                                        data-motcle="{{ partie1_mot|escapejs }}"
                                                        >
                                                    Graphe
                                                </button>
                                            </div>
                                        </td>
                                    </tr> 
                                {% elif search_site == 'www.Liberation.fr' %}
                                            <tr>
                                                <td>{{ partie1_mot }}</td>
                                                <td>www.Liberation.fr</td>
                                                <td>{{ total_articles_count_liberation_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_titre_page_accueil_liberation_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_titre_liberation_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_auteur_liberation_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_description_liberation_p1|intcomma  }}</td>
                                                <td>
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Liberation.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                               
                                    
                                {% elif search_site == 'www.Lemonde.fr' %}
                                            <tr>
                                                <td>{{ partie1_mot }}</td>
                                                <td>www.Lemonde.fr</td>
                                                <td>{{ total_articles_count_lemonde_p1|intcomma }}</td>
                                                <td>{{ mot_cle_count_titre_page_accueil_lemonde_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_titre_lemonde_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_auteur_lemonde_p1|intcomma  }}</td>
                                                <td>{{ mot_cle_count_description_lemonde_p1|intcomma  }}</td>
                                                <td>
                                                    <div class="mb-2">
                                                        <button class="btn btn-primary fetch-chart-data"
                                                                data-site="{{ 'www.Lemonde.fr'|escapejs }}"
                                                                data-motcle="{{ partie1_mot|escapejs }}"
                                                                >
                                                            Graphe
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                    
                                {% elif search_site == 'www.Lefigaro.fr' %}
                                    <tr>
                                        <td>{{ partie1_mot  }}</td>
                                        <td>www.Lefigaro.fr</td>
                                        <td>{{ total_articles_count_lefigaro_p1|intcomma }}</td>
                                        <td>{{ mot_cle_count_titre_page_accueil_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_titre_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_auteur_lefigaro_p1|intcomma  }}</td>
                                        <td>{{ mot_cle_count_description_lefigaro_p1|intcomma  }}</td>
                                        <td>
                                            <div class="mb-2">
                                                <button class="btn btn-primary fetch-chart-data"
                                                        data-site="{{ 'www.Lefigaro.fr'|escapejs }}"
                                                        data-motcle="{{ partie1_mot|escapejs }}"
                                                        >
                                                    Graphe
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                                                  
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </tbody>
                </table>
            </div>

<!--   graphe -->
<div class="mt-8">
    <h5>Graphique de Statistiques :</h5>
    <div id="chart-container" style="width: 100% !important; height: 350px !important;">
        <canvas id="motcleChart"></canvas>
    </div>
    
    <br>
</div>





   


    
    

            <!-- Tableau des articles -->
           <!-- Tableau des articles -->
<div class="row px-0 g-0 p-20">
    <h3>Articles :</h3>
    <div class="table custom-table-striped">
        <!-- Conteneur avec une barre de défilement horizontale -->
        <div class="table-container-x" style="overflow-x: auto;width: 1200px;"> <!-- 100% pour adapter à la largeur de l'écran -->
            <table class="table table-hover table-info text-dark">
                <thead class="thead-secondary text-dark h6">
                    <tr>
                        <th style="width: 0.2%;">Id</th>
                        <th style="width: 100px;">Titre Page Accueil</th>
                        <th style="width: 10%;">Titre</th>
                        <th style="width: 5%;">Lien</th>
                        <th style="width: 4%;">Date Publication</th>
                        <th style="width: 3%;">Auteur</th>
                        <th style="width: 20%;">Description</th>
                        <th style="width: 2%;">Statut Image</th>
                        <th style="width: 3%;">Actualité</th>
                        <th style="width: 3%;">Date Exportation</th>
                        <th style="width: 3%;">Catégorie</th>
                        <th style="width: 3%;">Ordre d'Actualité</th>
                        <th style="width: 5%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for article in articles_Statistiques_mot_cle %}
                    <tr>
                        <td><p>{{ article.id }}</p></td>
                        <td><p>{{ article.titre_page_accueil|safe }}</p></td>
                        <td><p>{{ article.titre|safe }}</p></td>
                        <td><p><a href="{{ article.lien }}">{{ article.lien }}</a></p></td>
                        <td><p>{{ article.date_publication }}</p></td>
                        <td><p>{{ article.nom_auteur|safe }}</p></td>
                        <td>
                            <p>{{ article.description_article|safe }}</p>
                        </td>
                        <td><p>{{ article.statut_image }}</p></td>
                        <td><p>{{ article.actualite }}</p></td>
                        <td><p>{{ article.date_exportation }}</p></td>
                        <td><p>{{ article.categorie }}</p></td>
                        <td><p>{{ article.ordre_actualite }}</p></td>
                        <td>
                            <div class="actions mt-3">
                                <div class="mb-2">
                                    <a href="{% url 'compter_doublons_articles' article.id %}" class="btn btn-primary">Cycle Vie</a>
                                </div>
                                <div>
                                    <a href="{% url 'telecharger_article_unique_excel' article.id %}" class="btn btn-success">Télécharger</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="13"><h4>Aucun Article Trouvé.</h4></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

            
            
            


<!-- Pagination Controls -->
<div class="d-flex justify-content-center">
    <nav aria-label="Page navigation example">
        <ul class="pagination">
            {% if articles_Statistiques_pagination.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ articles_Statistiques_pagination.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            <!-- Loop through page numbers -->
            {% for num in articles_Statistiques_pagination.paginator.page_range %}
                {% if num > articles_Statistiques_pagination.number|add:-5 and num < articles_Statistiques_pagination.number|add:5 %}
                    <li class="page-item {% if articles_Statistiques_pagination.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if articles_Statistiques_pagination.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ articles_Statistiques_pagination.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>


                    
                  
                </div>
            </div>          
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        var motcleChart = null;
    
        function fetchChartData(site, motcle, date_1, date_debut, date_fin) {
            fetch(`{% url 'plot_motcle_counts' %}?site=${site}&motcle=${motcle}&date_1=${date_1}&date_debut=${date_debut}&date_fin=${date_fin}`, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                var canvas = document.getElementById('motcleChart');
                var ctx = canvas.getContext('2d');
    
                // Définir la taille du canvas
                canvas.width = window.innerWidth;
                canvas.height = 600;
    
                if (motcleChart !== null) {
                    motcleChart.destroy();
                }
    
                if (site ==='Tous les sites') {
                    console.log(data.count_order1_liberation);
                    motcleChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            // Utilisation de date_1 passé par Django
                            labels: [`Apartir du ${date_1}`], // Affiche "Apartir du {{ date_1 }}"
                            datasets: [
                                {
                                    label: 'Ordre 1',
                                    data: [data.count_order1_liberation],
                                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                },
                                {
                                    label: 'Ordre 2',
                                    data: [data.count_order2_liberation],
                                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                },
                                {
                                    label: 'Ordre 3',
                                    data: [data.count_order3_liberation],
                                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            indexAxis: 'x', // Les barres s'alignent horizontalement
                            scales: {
                                x: {
                                    categoryPercentage: 1.0,
                                    barPercentage: 0.5 // Réduit la largeur des barres
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        font: {
                                            size: 16,
                                            weight: 'bold'
                                        },
                                        color: 'rgba(0, 0, 0, 0.7)'
                                    },
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)',
                                        lineWidth: 2
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Graphe des ordres d'actualité pour le mot-clé "${motcle}" sur  "${site}"`,
                                    font: {
                                        size: 22,
                                        weight: 'bold'
                                    },
                                    color: 'rgba(0, 0, 0, 0.9)'
                                },
                                legend: {
                                    display: true,
                                    position: 'bottom' // Positionne la légende sous le graphe
                                },
                                tooltip: {
                                    enabled: true,
                                    mode: 'index', // Affiche les tooltips pour toutes les barres survolées
                                    intersect: false, // Les tooltips s'affichent même si on ne survole pas directement une barre
                                    callbacks: {
                                        label: function(tooltipItem) {
                                            var label = tooltipItem.dataset.label || '';
                                            var value = tooltipItem.raw || 0;
                                            return `${label}: ${value} articles`;
                                        },
                                        title: function(tooltipItem) {
                                            return `Date: ${tooltipItem[0].label}`; // Affiche la date de la donnée (optionnel)
                                        }
                                    }
                                }
                            },
                            elements: {
                                bar: {
                                    borderRadius: 5,
                                    barThickness: 30 // Réduit la largeur des barres à 30
                                }
                            }
                        }
                    });
                } else {
                    motcleChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            // Utilisation de date_1 passé par Django
                            labels: [`Apartir du ${date_1}`], // Affiche "Apartir du {{ date_1 }}"
                            datasets: [
                                {
                                    label: 'Ordre 1',
                                    data: [data.count_order1],
                                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                },
                                {
                                    label: 'Ordre 2',
                                    data: [data.count_order2],
                                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                },
                                {
                                    label: 'Ordre 3',
                                    data: [data.count_order3],
                                    backgroundColor: 'rgba(255, 99, 132, 0.5)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 1,
                                    borderColor: 'rgba(0,0,0,1)',
                                    barThickness: 20
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            indexAxis: 'x', // Les barres s'alignent horizontalement
                            scales: {
                                x: {
                                    categoryPercentage: 1.0,
                                    barPercentage: 0.5 // Réduit la largeur des barres
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        font: {
                                            size: 16,
                                            weight: 'bold'
                                        },
                                        color: 'rgba(0, 0, 0, 0.7)'
                                    },
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)',
                                        lineWidth: 2
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Graphe des ordres d'actualité pour le mot-clé "${data.motcle}" sur le site "${data.site}"`,
                                    font: {
                                        size: 22,
                                        weight: 'bold'
                                    },
                                    color: 'rgba(0, 0, 0, 0.9)'
                                },
                                legend: {
                                    display: true,
                                    position: 'bottom' // Positionne la légende sous le graphe
                                },
                                tooltip: {
                                    enabled: true,
                                    mode: 'index', // Affiche les tooltips pour toutes les barres survolées
                                    intersect: false, // Les tooltips s'affichent même si on ne survole pas directement une barre
                                    callbacks: {
                                        label: function(tooltipItem) {
                                            var label = tooltipItem.dataset.label || '';
                                            var value = tooltipItem.raw || 0;
                                            return `${label}: ${value} articles`;
                                        },
                                        title: function(tooltipItem) {
                                            return `Date: ${tooltipItem[0].label}`; // Affiche la date de la donnée (optionnel)
                                        }
                                    }
                                }
                            },
                            elements: {
                                bar: {
                                    borderRadius: 5,
                                    barThickness: 30 // Réduit la largeur des barres à 30
                                }
                            }
                        }
                    });
                }
    
                // Mettre à jour le menu de légende
                updateLegendMenu([
                    { label: 'Ordre 1', color: 'rgba(54, 162, 235, 0.5)' },
                    { label: 'Ordre 2', color: 'rgba(75, 192, 192, 0.5)' },
                    { label: 'Ordre 3', color: 'rgba(255, 99, 132, 0.5)' }
                ]);
            })
            .catch(error => console.error('Erreur lors de la récupération des données:', error));
        }
    
        function updateLegendMenu(colors) {
            // Sélectionner le conteneur du menu déjà présent dans la structure HTML
            var legendContainer = document.getElementById('legend-menu');
    
            // Effacer le contenu précédent pour éviter les doublons
            legendContainer.innerHTML = '';
    
            // Ajouter des éléments de légende
            colors.forEach(colorItem => {
                var legendItem = document.createElement('div');
                legendItem.style.display = 'flex';
                legendItem.style.alignItems = 'center';
                legendItem.style.gap = '8px';
    
                var colorBox = document.createElement('span');
                colorBox.style.width = '20px';
                colorBox.style.height = '20px';
                colorBox.style.backgroundColor = colorItem.color;
                colorBox.style.border = '1px solid rgba(0, 0, 0, 0.3)';
                colorBox.style.borderRadius = '3px';
    
                var label = document.createElement('span');
                label.innerText = colorItem.label;
                label.style.fontSize = '16px';
                label.style.color = 'rgba(0, 0, 0, 0.7)';
                label.style.fontWeight = 'bold';
    
                legendItem.appendChild(colorBox);
                legendItem.appendChild(label);
                legendContainer.appendChild(legendItem);
            });
        }
    
        document.querySelectorAll('.fetch-chart-data').forEach(button => {
            button.addEventListener('click', function(event) {
                var site = event.target.getAttribute('data-site');
                var motcle = event.target.getAttribute('data-motcle');
                var currentUrl = window.location.href;
                var urlObj = new URL(currentUrl);
                var searchParams = urlObj.searchParams;
    
                var date_1 = searchParams.get('search_date') || '';
                var date_debut = searchParams.get('search_date_debut') || '';
                var date_fin = searchParams.get('search_date_fin') || '';
    
                fetchChartData(site, motcle, date_1, date_debut, date_fin);
            });
        });
    </script>
    
       <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
       <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   
</body>
{% include 'footer.html' %}
</html>
